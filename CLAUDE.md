# CLAUDE.md

## 설계 최우선 원칙 (Design First)

**구현보다 설계가 반드시 먼저 진행되어야 합니다.**

코드를 작성하기 전에 다음을 완료해야 합니다:

1. **요구사항 정리**: 이해한 요구사항을 구조화하여 명확하게 정리
2. **사이드이펙트 조사**: 변경으로 인해 영향받는 기존 코드, 의존성, 동작을 사전에 파악
3. **설계 반영**: 요구사항과 사이드이펙트를 모두 반영한 구조를 설계

```
❌ 요청 → 바로 구현
✅ 요청 → 요구사항 정리 → 사이드이펙트 조사 → 설계 → 승인 → 구현
```

> `/develop` 워크플로우를 사용하면 이 원칙이 Phase 1 (DESIGN) → Phase 2 (REVIEW) → Phase 3 (IMPLEMENT) 순서로 자동 적용됩니다.

## 구현 원칙 (Implementation Principles)

**외부 의존성은 반드시 인터페이스(trait)로 분리하고, 테스트를 먼저 작성합니다.**

### 원칙 (SOLID + TDD)

1. **단일 책임 (SRP)**: 하나의 모듈/구조체는 하나의 책임만 갖는다. 변경의 이유가 둘 이상이면 분리한다.
2. **개방-폐쇄 (OCP)**: 새로운 상태/타입이 추가될 때 기존 코드를 수정하지 않고 확장할 수 있어야 한다. enum 분기가 여러 곳에 흩어져 있으면 trait 기반 다형성이나 전략 패턴으로 전환하여 한 곳만 변경하면 되도록 한다.
3. **리스코프 치환 (LSP)**: Port의 모든 구현체(Adapter, Mock)는 trait이 정의한 계약을 동일하게 만족해야 한다. Mock이 실제 동작과 다른 가정을 하면 테스트의 신뢰성이 무너진다.
4. **인터페이스 분리 (ISP)**: Port는 역할별로 분리한다. 하나의 거대한 인터페이스가 아닌, 각 외부 시스템별로 독립적인 trait을 정의한다.
5. **의존성 역전 (DIP)**: 코어 로직은 외부 시스템(API, DB, CLI, 파일시스템)을 직접 호출하지 않는다. trait으로 정의된 Port를 통해서만 접근한다.
6. **테스트 우선 (TDD)**: 코어 로직 구현 전에 블랙박스 테스트를 먼저 작성한다. Mock/In-Memory 구현체로 시나리오를 주입하고, 최종 아웃풋을 기준으로 검증한다.

### 구조

```
Port (trait 정의)     → 코어 로직이 의존하는 인터페이스
Adapter (실제 구현)    → Port를 구현하는 외부 시스템 연결 코드
Mock (테스트용 구현)   → Port를 구현하는 인메모리 시뮬레이터
Engine (코어 로직)     → Port에만 의존, 순수 비즈니스 로직
```

### 작업 순서

```
❌ 코어 로직 구현 → 나중에 테스트 추가
✅ Port 정의 → Mock 구현 → 블랙박스 테스트 작성 (fail) → 코어 구현 (pass) → Adapter 연결
```

### 적용 범위

- **적용**: 외부 시스템과 상호작용하는 기능 구현 (API 호출, DB 접근, CLI 실행 등)
- **제외**: 단순 버그 수정, 설정 변경, 문서 수정 등 외부 의존성이 없는 작업

## PR 타이틀 / 커밋 메시지 규칙

`.claude/rules/git-workflow.md` 를 따릅니다.
