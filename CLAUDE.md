# CLAUDE.md

## 설계 최우선 원칙 (Design First)

**구현보다 설계가 반드시 먼저 진행되어야 합니다.**

코드를 작성하기 전에 다음을 완료해야 합니다:

1. **요구사항 정리**: 이해한 요구사항을 구조화하여 명확하게 정리
2. **사이드이펙트 조사**: 변경으로 인해 영향받는 기존 코드, 의존성, 동작을 사전에 파악
3. **설계 반영**: 요구사항과 사이드이펙트를 모두 반영한 구조를 설계

```
❌ 요청 → 바로 구현
✅ 요청 → 요구사항 정리 → 사이드이펙트 조사 → 설계 → 승인 → 구현
```

> `/develop` 워크플로우를 사용하면 이 원칙이 Phase 1 (DESIGN) → Phase 2 (REVIEW) → Phase 3 (IMPLEMENT) 순서로 자동 적용됩니다.

## 구현 원칙 (Implementation Principles)

### SOLID

1. **단일 책임 (SRP)**: 하나의 모듈/구조체는 하나의 책임만 갖는다. 변경의 이유가 둘 이상이면 분리한다.
2. **개방-폐쇄 (OCP)**: 새로운 상태/타입 추가 시 기존 코드를 수정하지 않고 확장할 수 있어야 한다. 동일한 분기가 여러 곳에 흩어져 있으면 다형성이나 전략 패턴으로 전환하여 변경 지점을 하나로 줄인다.
3. **리스코프 치환 (LSP)**: 인터페이스의 모든 구현체는 해당 인터페이스가 정의한 계약을 동일하게 만족해야 한다. 호출하는 쪽은 어떤 구현체가 들어오든 동작이 보장되어야 한다.
4. **인터페이스 분리 (ISP)**: 인터페이스는 역할별로 분리한다. 하나의 거대한 인터페이스가 아닌, 사용하는 쪽이 필요로 하는 메서드만 포함하는 작은 인터페이스를 정의한다.
5. **의존성 역전 (DIP)**: 코어 로직은 구체 구현에 직접 의존하지 않는다. 추상(인터페이스)에 의존하고, 구체 구현은 외부에서 주입받는다.

### TDD

코어 로직 구현 전에 블랙박스 테스트를 먼저 작성한다. 인메모리 구현체로 시나리오를 주입하고, 최종 아웃풋을 기준으로 검증한다.

```
❌ 코어 로직 구현 → 나중에 테스트 추가
✅ 인터페이스 정의 → 테스트용 구현 → 테스트 작성 (fail) → 코어 구현 (pass) → 실제 구현 연결
```

### 적용 범위

- **적용**: 외부 시스템과 상호작용하는 기능 구현 (API 호출, DB 접근, CLI 실행 등)
- **제외**: 단순 버그 수정, 설정 변경, 문서 수정 등 외부 의존성이 없는 작업

## 코드 품질 게이트 (Quality Gate)

lint, format, test가 실패하면 변경된 부분이 아니더라도 반드시 수정해야 합니다.

```
❌ 내가 변경한 파일이 아니니까 무시
✅ pre-push hook 또는 CI에서 실패하면 해당 오류를 모두 수정한 뒤 push
```

- `cargo fmt --check` 실패 → `cargo fmt` 실행하여 수정
- `cargo clippy -- -D warnings` 실패 → clippy 경고를 코드 수정 또는 `#[allow]`로 해결
- `cargo test` 실패 → 테스트가 통과하도록 수정
- pre-push hook은 **모든** Rust 프로젝트를 검증합니다 (변경 여부 무관)

## PR 타이틀 / 커밋 메시지 규칙

`.claude/rules/git-workflow.md` 를 따릅니다.
