---
description: 현재 레포를 자율 개발 모니터링 대상으로 등록합니다
allowed-tools: ["AskUserQuestion", "Bash"]
---

# 자율 개발 모니터링 설정 위자드 (/auto-setup)

> **이 플러그인은 반드시 User Scope로 설치**해야 합니다.
> 사용자가 모니터링하려는 레포 디렉토리에서 이 커맨드를 호출합니다.

## 실행 흐름

### Step 1: 레포 감지

현재 디렉토리의 git remote에서 레포 URL을 자동 감지합니다:

```bash
git remote get-url origin
```

감지된 URL을 사용자에게 확인합니다.

### Step 1.5: GitHub Enterprise 자동 감지

감지된 URL에서 호스트를 추출하여 GitHub Enterprise 여부를 자동 판별합니다:

- `github.com` → 일반 GitHub (추가 설정 불필요, 다음 단계로)
- 호스트에 `github`이 포함된 다른 도메인 (예: `github.mycompany.com`) → GitHub Enterprise로 감지
- `github`이 포함되지 않은 호스트 (예: `gitlab.com`, `bitbucket.org`) → GitHub이 아닌 호스트로 판단, `gh api` 미사용이므로 패스

**Enterprise 감지 시:**

```
GitHub Enterprise가 감지되었습니다: {detected_host}

gh CLI 인증을 확인합니다...
```

```bash
gh auth status --hostname {detected_host} 2>&1
```

**인증 안 된 경우:**

```
GitHub Enterprise 인증이 필요합니다.
다음 명령어로 로그인해주세요:

  gh auth login --hostname {detected_host}

로그인 후 /auto-setup을 다시 실행하세요.
```

→ 설정을 중단합니다.

**인증 된 경우:**

감지된 호스트를 `gh_host`로 저장하여 Step 9의 config JSON에 포함합니다.
`~/.git-workflow-env` 파일이 없으면 함께 생성합니다:

```bash
if [ ! -f ~/.git-workflow-env ]; then
  cat > ~/.git-workflow-env << 'ENV'
# git-workflow 환경 설정
# Generated by /auto-setup
export GH_HOST="{detected_host}"
ENV
  chmod 600 ~/.git-workflow-env
fi
```

### Step 2: 의존성 검증

다음 플러그인이 `kys-claude-plugin` 마켓플레이스에서 User Scope로 설치되어 있는지 확인하세요:

| 구분 | 플러그인 | 마켓플레이스 |
|------|---------|-------------|
| 필수 | `develop-workflow` | `kys-claude-plugin` |
| 필수 | `git-utils` | `kys-claude-plugin` |
| 권장 | `external-llm` | `kys-claude-plugin` |

미설치 시 안내:
- 필수 → 경고 + `/plugin install <name>@kys-claude-plugin`
- 권장 → multi-LLM 분석이 Claude 단일 모델로 fallback됨을 안내

설치 확인이 완료되지 않으면 다음 단계로 진행하지 마세요.

### Step 3: CLI 설치 및 버전 확인

플러그인의 `ensure-binary.sh` 스크립트로 `autonomous` CLI 바이너리의 설치 및 버전을 확인합니다.
이 스크립트는 `plugin.json` 버전과 설치된 바이너리 버전을 비교하여 신규 설치, 업데이트, 스킵을 자동으로 결정합니다.

```bash
bash ${CLAUDE_PLUGIN_ROOT}/scripts/ensure-binary.sh
```

- **바이너리 미설치** → 자동 빌드 + `~/.local/bin/autonomous`에 설치
- **설치 버전 < 플러그인 버전** → 재빌드 + 설치
- **설치 버전 >= 플러그인 버전** → 스킵

실패 시:
- `cargo`가 없으면 [Rust 설치](https://rustup.rs/)를 안내하고 중단합니다.
- `~/.local/bin`이 `$PATH`에 포함되어 있지 않으면 Step 10(셸 환경 등록)에서 함께 등록될 것임을 안내합니다.

### Step 4: 감시 대상 설정

AskUserQuestion으로 질문:
- 감시 대상: Issues / Pull Requests / 둘 다

### Step 5: 스캔 주기

AskUserQuestion으로 질문:
- 1분 (빠른 반응)
- 5분 (권장)
- 15분 (저부하)
- 직접 입력

### Step 6: Consumer 처리량

AskUserQuestion으로 질문:
- Issue Consumer 동시 처리 수 (1~3)
- PR Consumer 동시 처리 수 (1~3)
- Merge Consumer 동시 처리 수 (1~2)

### Step 7: 워크플로우 선택

AskUserQuestion으로 질문:
- Issue 분석: multi-LLM (Claude+Codex+Gemini) / 단일 모델
- PR 리뷰: /multi-review / 단일 모델

### Step 8: 필터 설정

AskUserQuestion으로 질문:
- 전체 이슈/PR 감시
- 특정 라벨만 (라벨명 입력)
- 특정 작성자 제외 (기본: dependabot, renovate)

### Step 9: 등록

수집된 설정을 JSON으로 구성하여 CLI에 전달합니다.
Step 1.5에서 Enterprise가 감지된 경우 `gh_host` 필드를 config JSON에 포함합니다:

```bash
# 일반 GitHub
autonomous repo add <url> --config '<json>'

# GitHub Enterprise (gh_host 포함)
autonomous repo add <url> --config '{"gh_host": "github.mycompany.com", ...}'
```

### Step 10: 셸 환경 등록

최초 설정 시 셸 프로필에 환경변수와 alias를 등록할지 확인:

```bash
# ~/.bashrc 또는 ~/.zshrc에 추가
export AUTONOMOUS_HOME="$HOME/.autonomous"
export PATH="$HOME/.local/bin:$PATH"

alias auto="autonomous"
alias auto-s="autonomous status"
alias auto-d="autonomous dashboard"
alias auto-q="autonomous queue list"
```

### Step 11: 설정 요약

최종 설정을 사용자에게 보기 좋게 출력합니다.
